meta:
    project: dobi

mount=source-dir:
    bind: .
    path: /source

mount=build-dir:
    bind: build
    path: /build

mount=install-dir:
    bind: install
    path: /install

# mount=projectdir:
#     bind: .
#     path: '{fs.projectdir}'

#
# Images
#

image=builder:
    image: mdcii-builder
    context: docker/
    dockerfile: Dockerfile

#
# Jobs
#

job=build:
    use: builder
    artifact: ./build/mdcii-sdltest
    sources: ./source/mdcii/**/*.{cpp,hpp}
    mounts: [source-dir, build-dir]
    command: bash -c "cd /build && cmake /source && make -j12"
    env:
      - "LOCAL_USER_ID={user.uid}"
    annotations:
      description: "Build mdcii"
      tags: [build]

job=install:
    use: builder
    command: bash -c "cp /build/mdcii-sdltest /install"
    mounts: [build-dir, install-dir]
    interactive: true
    depends: [build]
    annotations:
      description: "Watch for code changes and run the unit tests"
      tags: [install]
    env:
      - "LOCAL_USER_ID={user.uid}"

